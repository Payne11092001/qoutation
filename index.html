<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sales Order</title>

<!-- html2pdf.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<!-- jQuery (required for Select2) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
:root {
  --border: #000;
  --grid-gray: #555;
  --purple: #b7a7d9;
  --yellow: #f6e08b;
  --bg: #ffffff;
  --text: #000;
  --cell-pad: 6px;
  --font: Arial, Helvetica, sans-serif;
}

html, body {
  background: #f6f7fb;
  margin: 0;
  padding: 12px;
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  line-height: 1.4;
}

 /*  Disabled Save button styling */
  #saveBtn:disabled {
    background-color: #dc3545 !important; /* red */
    cursor: not-allowed;
    opacity: 0.85;
    position: relative;
  }

  /* Tooltip container */
  #saveBtn[data-tooltip]:disabled::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 120%; /* show above the button */
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: #fff;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-in-out;
  }

  /* Small arrow under tooltip */
  #saveBtn[data-tooltip]:disabled::before {
    content: "";
    position: absolute;
    bottom: 110%;
    left: 50%;
    transform: translateX(-50%);
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
  }

  /* Show tooltip on hover */
  #saveBtn[data-tooltip]:disabled:hover::after,
  #saveBtn[data-tooltip]:disabled:hover::before {
    opacity: 1;
  }
.toolbar {
  display: flex;
  gap: 10px;
  margin: 0 auto 12px;
  max-width: 900px;
  align-items: center;
  justify-content: flex-end;
  flex-wrap: wrap;
    /* 🔹 Start hidden, animate in */
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInToolbar 0.8s ease-out forwards;
}

/* 🔹 Keyframes for fade-in + slide-up */
@keyframes fadeInToolbar {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.btn {
  border: 1px solid #0d6efd;
  background: #0d6efd;
  color: #fff;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;

  /* 🔹 Smooth transitions */
  transition: background 0.3s ease,
              transform 0.2s ease,
              box-shadow 0.3s ease;
}

/* 🔹 Hover effect */
.btn:hover {
  background: #0056b3;
  transform: translateY(-3px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.25);
}

/* 🔹 Active (click) effect */
.btn:active {
  transform: scale(0.95);
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

/* 🔹 Disabled style */
.btn:disabled {
  background: #aaa;
  border-color: #aaa;
  cursor: not-allowed;
  opacity: 0.7;
  transform: none;
  box-shadow: none;
}
.btn-danger {
  background: #dc3545;
  border-color: #dc3545;
}

/* ✅ Normal screen view (unchanged) */
.sheet {
  width: 100%;
  max-width: 297mm; /* Landscape width */
  min-height: 210mm; /* Landscape height */
  margin: 0 auto 14px;
  background: var(--bg);
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 8px 18px rgba(16,24,40,.06);
  padding: 12px;
  box-sizing: border-box;
}

/* ✅ Print / Save to PDF */
@media print {
  .sheet {
    transform: scale(0.4);        /* shrink to 90% */
    transform-origin: top center; /* keep centered */
  }
}

.table-wrap {
  overflow-x: auto;
  width: 100%;
}

table {
  border-collapse: collapse;
  width: 100%;
  font-size: 13px;
  word-break: break-word;
}

th, td {
  border: 1px solid var(--border);
  padding: var(--cell-pad);
  vertical-align: middle;
  background: #fff;
  text-align: left;
}

.title-row th {
  background: var(--grid-gray);
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  text-align: center;
}

.purple {
  background: var(--purple);
  font-weight: bold;
  text-align: center;
}
.no-border {
  border: 0 !important;
}
.label {
  font-weight: bold;
  white-space: nowrap;
}
.total-row td {
  background: var(--yellow);
  font-weight: bold;
}
.note-cell {
  white-space: nowrap;
  font-weight: bold;
  width: 12%;
}

input[type="text"],
input[type="date"],
input[type="number"],
textarea {
  width: 100%;
  border: none;
  outline: none;
  font-family: inherit;
  font-size: 13px;
  background: transparent;
  padding: 2px;
  box-sizing: border-box;
}
textarea {
  height: 120px;
  resize: vertical; /* user can drag vertically */
}

.footer {
  text-align: center;
  font-size: 12px;
  color: #555;
  margin-top: 20px;
  padding: 10px 0;
}
.dev-name {
  font-weight: bold;
  color: #0d6efd; /* Bootstrap blue */
}

@media print {
  .footer {
    display: none; /* Hide footer when printing / saving as PDF */
  }
}

@page {
  size: A4;
  margin: 10mm;
}
@media print {
  body {
    background: #fff;
    padding: 0;
  }
  .toolbar {
    display: none;
  }
  .sheet {
    box-shadow: none;
    border: 0;
    margin: 0 auto;
    border-radius: 0;
    padding: 0;
    width: 210mm; /* force exact A4 width */
  }
}

@media (max-width: 768px) {
  body {
    padding: 6px;
  }
  .sheet {
    padding: 8px;
  }
  table {
    font-size: 12px;
  }
  .btn {
    padding: 6px 10px;
    font-size: 12px;
  }
}

  .commission-input {
    width: 50px;       /* adjust width */
    padding: 5px;       /* inner spacing */
    border: 1px solid #666;
    border-radius: 5px; /* rounded corners */
    text-align: right;  /* numbers align right */
    font-size: 14px;
  }

  th input.commission-input:focus {
    outline: 2px solid #353835; /* highlight when typing */
  }

/* ===== Mobile Responsive ===== */
@media (max-width: 768px) {
  body {
    padding: 6px;
  }

  .toolbar {
    flex-direction: column;
    align-items: stretch;
    gap: 6px;
  }

  .btn {
    padding: 10px;
    font-size: 14px;
    width: 100%; /* full width buttons on mobile */
  }

  .sheet {
    padding: 6px;
    border-radius: 4px;
    overflow-x: auto; /* allow scroll on smaller screens */
  }

  table {
    font-size: 12px;
    min-width: 700px; /* prevent columns from squishing too much */
  }

  th, td {
    padding: 4px;
  }

  /* Inputs inside table */
  input[type="text"],
  input[type="date"],
  input[type="number"],
  select,
  textarea {
    font-size: 12px;
    padding: 4px;
  }

  textarea {
    height: 80px; /* smaller default height on mobile */
  }

  .note-cell {
    width: auto; /* let it shrink naturally */
    font-size: 12px;
  }

  /* Footer small */
  .footer {
    font-size: 11px;
    padding: 6px 0;
  }
}

@media (max-width: 480px) {
  table {
    font-size: 11px;
    min-width: 600px;
  }

  .btn {
    font-size: 12px;
    padding: 8px;
  }

  .commission-input {
    width: 40px;
    font-size: 12px;
  }
}

</style>
</head>
<body>

<div class="toolbar">
  <button class="btn" onclick="addRow()">➕ Add Row</button>
  <button id="saveBtn" class="btn" onclick="savePDF()" disabled>💾 Save as PDF</button>
</div>

<div id="printArea">
  <section class="sheet">
    <div class="table-wrap">
      <table aria-label="Sales Order" id="orderTable">
        <colgroup>
          <col style="width:15%">
          <col style="width:7%">
          <col style="width:14%">
          <col style="width:14%">
          <col style="width:10%">
          <col style="width:2%">
          <col style="width:2%">
          <col style="width:2%">
          <col style="width:2%">
        </colgroup>

        <tbody>
        <!-- Title -->
        <tr class="title-row">
          <th colspan="5">Sale's Order</th>
    
          <th colspan="10">Mode of payment</th>
        </tr>
        <!-- Company / Date / Payment row -->
        <tr>
          <td class="label">Company name:</td>
          <td colspan="4" ><input type="text"required placeholder="Input the company name"/></td>
          <td colspan="2"class="label">Cash:</td>
          <td colspan="8"><input type="checkbox" /></td>
        </tr>
        <tr>
          <td class="label">Address:</td>
          <td colspan="4"><input type="text" required placeholder="Input the address"/></td>
          <td colspan="2"class="label">Gcash:</td>
          <td colspan="8"><input type="checkbox" /></td>
        </tr>
        <tr>
          <td class="label">Order Date:</td>
          <td colspan="4"><input type="date" required/></td>
          <td colspan="2"class="label">Bank Transfer:</td>
          <td colspan="8"><input type="checkbox" /></td>
        </tr>
        <tr>
          <td class="label">Delivery Date:</td>
          <td colspan="4"><input type="date" required/></td>
          <td colspan="2"class="label">Cheque:</td>
          <td colspan="8"><input type="checkbox" /></td>
        </tr>
                                             
        <tr>
          <th class="purple text-center"colspan="1" >TAX</th>
          <th class="purple text-center" colspan="3">CLIENT</th>
          <th colspan="5" class="purple">Production Needs</th>
          <th colspan="3">8A<input type="checkbox" id="chkCustomize" onclick="toggleCheckboxes(this)" /></th>
          <th  colspan="7">Customize<input type="checkbox"  id="chk8A" onclick="toggleCheckboxes(this)"/> </th>
        </tr>
        <tr>
          <td colspan="1">w/out commission:<input type="checkbox" /></td>
          <td colspan="3">Distributor: <input type="checkbox" /></td>
            <td colspan="12">Expiration Date: <input type="checkbox" /></td>
        </tr>

        <tr>
          <td colspan="1">w/ commission:<input type="checkbox" /></td>
          <td colspan="3">Non Distributor: <input type="checkbox" /></td>
         <td colspan="12">Mfg Date: <input type="checkbox" /></td>
        </tr>

        <tr>
          <td colspan="1">w/ bfp commission:<input type="checkbox" /></td>
          <td colspan="3">End User: <input type="checkbox" /></td>
             <td colspan="12">Serial No.: <input type="checkbox" /></td>
        </tr>

        <tr>
          <td>
            VAT Included: <input type="checkbox" id="vatIncluded" onchange="calculateTotal()" onclick="toggleCheckboxes(this)">
          </td>
          <td colspan="3">Corporate: <input type="checkbox" /></td>
          <td colspan="12">Only do not test and press handle:<input type="checkbox" /></td>
        </tr>
        <tr>
          <td> VAT Excluded: <input type="checkbox" id="vatExcluded" onchange="calculateTotal()" onclick="toggleCheckboxes(this)"> </td>
          <td colspan="3">SALES OFFICER: <input type="text" required/></td>
        <td colspan="3">Decals/Sticker:</td>
          <td colspan="3">Customize<input type="checkbox" /></td>
          <td colspan="7">8A<input type="checkbox" /></td>
        </tr>

        <tr>
          <td colspan="1">w/ ewt 1%: <input type="checkbox" /></td>
          <td colspan="3"></td>
           <td colspan="3">Inspection Tag:</td>
           <td colspan="3">Customize<input type="checkbox" /></td>
          <td colspan="7">8A<input type="checkbox" /></td>
        </tr>
        <!-- Headers: Items -->
          <tr>
            <th class="purple">UNIT</th>
            <th class="purple">QTY</th>
            <th class="purple" colspan="2">Articles</th>
            <th class="purple" colspan="1">PRICE</th>
            <th class="purple" colspan="2">Amount</th>
          
            <th class="purple" colspan="3">Bfp Commission</th>
            <th class="purple" colspan="2">Distri. Commission</th>
            <th class="purple" colspan="2">Corp. Comission</th>
              <th class="purple" colspan="2">Action</th>
          </tr>

        <!-- Sample Initial Row -->
        <tr class="item-row">
          <td>
            <input type="text" class="itemInput" style="width:100%;" required placeholder="Enter Item"/>
          </td>
          <td>
            <input type="number" class="qty" onchange="calculateTotal()" oninput="calculateTotal()" required placeholder="0.00"/>
          </td>
          <td colspan="2">
            <input type="text" class="categoryInput" style="width:100%;" required placeholder="Enter Category"/>
          </td>
          <td>
            <input type="number" step="0.01" class="price" onchange="calculateTotal()" oninput="calculateTotal()" required placeholder="0.00"/>
          </td>
          <td colspan="2" class="amount"></td>
          <td colspan="3">
            <input type="number" class="bfp" oninput="calculateTotal()" required placeholder="0.00"/>
          </td>
          <td colspan="2">
            <input type="number" class="distri" oninput="calculateTotal()" required placeholder="0.00"/>
          </td>
          <td colspan="2">
            <input type="number" class="corpo" oninput="calculateTotal()" required placeholder="0.00"/>
          </td>
          <td colspan="2">
            <button class="btn btn-danger" onclick="removeRow(this)">🗑</button>
          </td>

        </tr>
        <!-- Total Price Row -->
        <tr class="total-row">
          <td colspan="5" style="text-align:right;" >Total Price:</td>
          <td colspan="10"><input type="text"  id="totalPrice" readonly placeholder="0.00" /></td>
        </tr>
 

        <!-- Notes -->
        <tr>
          <td class="note-cell">Note:</td>
          <td colspan="16"><textarea name="note"></textarea></td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

<!-- Footer outside printArea -->
<footer class="footer">
  © 2025 8A Fire Safety Maintenance and Manufacturing Corp. | All Rights Reserved 
  <br>
  <a href="https://payne11092001.github.io/portfiolio/" target="_blank" class="dev-name">Developed by ArmanB.</a>
</footer>




<script>
function toggleCheckboxes(clicked) {
  // Ensure only one checkbox is active at a time
  if (clicked.id === "vatIncluded") {
    document.getElementById("vatExcluded").checked = false;
  } else if (clicked.id === "vatExcluded") {
    document.getElementById("vatIncluded").checked = false;
  }
}

function calculateTotal() {
  let rows = document.querySelectorAll(".item-row");
  let total = 0;
  let vatIncluded = document.getElementById("vatIncluded")?.checked;
  let vatExcluded = document.getElementById("vatExcluded")?.checked;

  rows.forEach(row => {
    let qty = parseFloat(row.querySelector(".qty")?.value) || 0;
    let priceInput = row.querySelector(".price");
    let price = parseFloat(priceInput.value) || 0;

    // ✅ Apply VAT logic
    let displayPrice = price;
    if (vatIncluded) {
      displayPrice = price * 1.12;   // add 12%
    } else if (vatExcluded) {
      displayPrice = price / 1.12;   // remove 12%
    }

    // ✅ Update price input to show FINAL price (VAT applied only)
    priceInput.value = displayPrice % 1 === 0 ? displayPrice : displayPrice.toFixed(2);

    // ✅ Calculate amount
    let amount = qty * displayPrice;
    row.querySelector(".amount").textContent =
      amount > 0 ? (amount % 1 === 0 ? amount : amount.toFixed(2)) : "";

    total += amount;
  });

  // ✅ Update total
  document.getElementById("totalPrice").value =
    total % 1 === 0 ? total : total.toFixed(2);

  validateForm();
}


  // Add Row Function
  function addRow(){
    let table = document.getElementById("orderTable").querySelector("tbody");
    let totalRow = table.querySelector(".total-row");
    let newRow = document.createElement("tr");
    newRow.classList.add("item-row");
    newRow.innerHTML = `
        <td>
          <input type="text" class="itemInput" style="width:100%;" required placeholder="Enter Item"/>
        </td>
        <td>
          <input type="number" class="qty" onchange="calculateTotal()" oninput="calculateTotal()" required placeholder="0.00"/>
        </td>
        <td colspan="2">
          <input type="text" class="categoryInput" style="width:100%;" required placeholder="Enter Category"/>
        </td>
        <td>
          <input type="number" step="0.01" class="price" onchange="calculateTotal()" oninput="calculateTotal()" required placeholder="0.00"/>
        </td>
        <td colspan="2" class="amount"></td>
        <td colspan="3">
          <input type="number" class="bfp" oninput="calculateTotal()" required placeholder="0.00"/>
        </td>
        <td colspan="2">
          <input type="number" class="distri" oninput="calculateTotal()" required placeholder="0.00"/>
        </td>
        <td colspan="2">
          <input type="number" class="corpo" oninput="calculateTotal()" required placeholder="0.00"/>
        </td>
        <td colspan="2">
          <button class="btn btn-danger" onclick="removeRow(this)">🗑</button>
        </td>

    `;
    table.insertBefore(newRow, totalRow);
    // ✅ Reinitialize Select2 for the new row
    initSelect2();
    validateForm();
  }
  // Remove Row Function
  function removeRow(btn){
    let row = btn.closest("tr");
    row.classList.add("removed");
    setTimeout(() => {
      row.remove();
      calculateTotal();
      validateForm();
    }, 300); // wait for fadeOut animation
  }
function removeRow(btn){
  let row = btn.closest("tr");
  row.remove();
  calculateTotal();
  validateForm();
}
function savePDF() {
  const saveBtn = document.getElementById("saveBtn");
  validateForm();
  if (saveBtn.disabled) {
    alert("⚠️ Please fill in at least one required field before saving as PDF.");
    return;
  }

  const element = document.getElementById("printArea");

  // ✅ Create wrapper for scaling
  const wrapper = document.createElement("div");
  wrapper.style.display = "flex";
  wrapper.style.justifyContent = "center"; 
  wrapper.style.alignItems = "center"; 
  wrapper.style.width = "100%";

  // ✅ Clone element so we don’t affect the original
  const copy = element.cloneNode(true);
  copy.style.transform = "scale(0.6)";   // 🔹 adjust 0.8 → smaller size (try 0.7 or 0.6 if you want smaller)
  copy.style.transformOrigin = "top left";
  copy.style.width = "100%";

  wrapper.appendChild(copy);

  const opt = {
    margin: [10, 10, 10, 10], // top, left, bottom, right
    filename: 'sales-order.pdf',
    image: { type: 'jpeg', quality: 0.95 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' } // ✅ Landscape A4
  };

  // ✅ Generate PDF
  html2pdf().set(opt).from(wrapper).save();
}


function toggleCheckboxes(clicked) {
  let chk8A = document.getElementById("chk8A");
  let chkCustomize = document.getElementById("chkCustomize");

  // Existing logic
  if (clicked.id === "chk8A") {
    chkCustomize.disabled = chk8A.checked; 
  } else if (clicked.id === "chkCustomize") {
    chk8A.disabled = chkCustomize.checked;
  }

  // ✅ New VAT logic
  let vatIncluded = document.getElementById("vatIncluded");
  let vatExcluded = document.getElementById("vatExcluded");

  if (clicked.id === "vatIncluded") {
    vatExcluded.checked = false;
  } else if (clicked.id === "vatExcluded") {
    vatIncluded.checked = false;
  }
}


// ✅ Enable Save if at least 1 required field is filled
function validateForm() {
  const saveBtn = document.getElementById("saveBtn");
  const requiredControls = document.querySelectorAll("#printArea input[required], #printArea textarea[required]");
  let anyFilled = false;

  requiredControls.forEach(el => {
    if (el.type === "checkbox") {
      if (el.checked) anyFilled = true;
      return;
    }
    const val = String(el.value || "").trim();
    if (val !== "") anyFilled = true;
  });

  saveBtn.disabled = !anyFilled;

  // Add tooltip only when disabled
  if (saveBtn.disabled) {
    saveBtn.setAttribute("data-tooltip", "⚠️ Please fill at least one required field to enable saving.");
  } else {
    saveBtn.removeAttribute("data-tooltip");
  }
}

function attachValidation() {
  const controls = document.querySelectorAll("#printArea input[required], #printArea textarea[required]");
  controls.forEach(el => {
    el.removeEventListener("input", validateForm);
    el.addEventListener("input", validateForm);
    el.removeEventListener("change", validateForm);
    el.addEventListener("change", validateForm);
  });
}

attachValidation();
validateForm();
</script>

<!-- Initialize Select2 -->
<script>
  // ✅ Initialize Select2 (first load + dynamically added selects)
  function initSelect2() {
    $('.categorySelect').select2({
      placeholder: "-- Select Category --",
      allowClear: true,
      tags: true
    });

    $('.itemSelect').select2({
      placeholder: "-- Select Item --",
      allowClear: true,
      tags: true
    });
  }

  // Run once on page load
  $(document).ready(function() {
    initSelect2();
  });

 
</script>
</body>
</html>

